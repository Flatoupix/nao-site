{% extends "layout.html.twig" %}

{% block body %}

	<h2>Rechercher</h2>

	<div class="row">
		<div class="col-lg-6 col-xs-12">

			<input type="search" class="form-control" style="padding-left: 25px;" placeholder="Entrez le nom de l'oiseau que vous recherchez" width="50">
			<i id="search" class="fa fa-search"></i>

			<div id="map"></div>


		</div>
	</div> <!-- row -->

{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script>
		var map;
		var locations = [];
		var markers = [];

		function initMap()
		{
			map = new google.maps.Map(document.getElementById('map'), {
				center: {lat: 48.856614, lng: 2.3522219000000177}, {# coordonn√©es de Paris #}
				zoom: 7
			});
			
			var largeInfoWindow = google.maps.InfoWindow();

			{% for observation in observations %}
				locations.push( {content: "{{ observation.content|replace({"\n":' ', "\r":' '}) }}", position: {lat: {{ observation.latitude }}, lng: {{ observation.longitude }} } });
			{% endfor %}

			for (var i = 0; i < locations.length; i++)
			{
				var position = locations[i].position;
				var content = locations[i].content;

				var marker = new google.maps.Marker({
					map: map,
					position: position,
					title: content,
					animation: google.maps.Animation.DROP,
					id: i
				});
				markers.push(marker);

				marker.addListener('click', function(){
					populateInfoWindow(this, largeInfoWindow);
				});
			}
		}

		function populateInfoWindow(marker, infoWindow)
		{
			if(infoWindow.marker != marker)
			{
				infoWindow.marker = marker;
				infoWindow.setContent('<div> + marker.title + </div>');
				infoWindow.open(map, marker);
				infoWindow.addListener('closeclick', function(){
					infoWindow.setMarker(null);
				});
			}
		}
	</script>
	<script async defer
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZjdDWppQRZkoIfeqHtm644-ncPYj9eXw&v=3&callback=initMap">
	</script>
{% endblock %}