{% extends "layout.html.twig" %}

{% block body %}

	<h2>Soumettre une observation</h2>

	<div class="row">

		<div class="col-lg-6 col-xs-12">

			{{ form(form) }}

		</div>


		<div class="col-lg-6 col-xs-12">
			<button id="btn-locate">Me localiser</button>
			<div id="map"></div>
		</div>

	</div><!-- row -->

{% endblock %}


{% block javascripts %}
	{{ parent() }}
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.24/jquery-ui.min.js"></script>
	<script src="{{ asset('js/maps.js') }}"></script>
	<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZjdDWppQRZkoIfeqHtm644-ncPYj9eXw&v=3&callback=initMap"></script>
	<script>
		{# // Permet autocomplete #}
		var sourceList = [];
		{% for oiseauName in listOiseauNames %}
			sourceList.push( "{{ oiseauName }}" );
		{% endfor %}

		$(function(){

			$('#appbundle_observation_nomOiseau').autocomplete({
				source: sourceList
			});

			$('#btn-locate').on('click', function(){
				
				if (navigator.geolocation) 
				{
					navigator.geolocation.getCurrentPosition(function(pos) {
						withDrawMarkers()
						console.log('lat: ' + pos.coords.latitude + ' long: ' + pos.coords.longitude )
						var myLat = pos.coords.latitude;
						var myLong = pos.coords.longitude;
						$('#appbundle_observation_latitude').val(myLat);
						$('#appbundle_observation_longitude').val(myLong);

						var marker = new google.maps.Marker({
							map: map,
							icon: defaultIcon,
							position: {lat: myLat, lng: myLong},
							animation: google.maps.Animation.DROP,
						});
						markers.push(marker);
					});
				}
			});
		});

	</script>
{% endblock %}
